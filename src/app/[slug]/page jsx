import fs from "fs";
import path from "path";
import matter from "gray-matter";
import SeoArticle from "@/Components/SeoArticle";
import { notFound } from "next/navigation";

// This function tells Next.js which paths to pre-render at build time
export async function generateStaticParams() {
  const postsDirectory = path.join(process.cwd(), "src/app/posts");
  const filenames = fs.readdirSync(postsDirectory);

  return filenames.map((filename) => ({
    slug: filename.replace(/\.md$/, ""),
  }));
}

export default async function Page({ params }) {
  const { slug } = params;

  // Use the slug to find the correct markdown file
  const filePath = path.join(process.cwd(), "src/app/posts", `${slug}.md`);

  // This check is a fallback for dynamic routes
  if (!fs.existsSync(filePath)) {
    return notFound();
  }

  const fileContent = fs.readFileSync(filePath, "utf-8");
  const { data, content } = matter(fileContent);

  const stats = fs.statSync(filePath);
  const modifiedDate = stats.mtime.toISOString();

  return (
    <SeoArticle
      title={data.title}
      description={data.description}
      publishDate={data.publishDate}
      modifiedDate={modifiedDate}
      tags={data.tags}
      canonical={data.canonical}
      ogImage={data.ogImage}
      markdown={content}
    />
  );
}
